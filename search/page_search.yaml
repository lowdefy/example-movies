id: page1
properties:
  title: Movie Search ðŸ”Ž
requests:
  _ref: search/search_requests.yaml
mutations:
  - name: mutation_like_movie
    type: mongodb_update_one
    connectionId: mongodb_mflix_movies
    properties:
      filter:
        _id:
          _state: results.$._id
      update:
        $inc:
          likes: 1
        $addToSet:
          liked_by:
            _user: id
  - name: mutation_unlike_movie
    type: mongodb_update_one
    connectionId: mongodb_mflix_movies
    properties:
      filter:
        _id:
          _state: results.$._id
      update:
        $inc:
          likes: -1
        $pull:
          liked_by:
            _user: id

initialState:
  loading: false
  search: titanic
  page:
    pageSize: 10
    skip: 0
  results:
    _request: req_search

blocks:
  - name: card_search
    type: card
    label:
      title: Search for a movie or actor
    blocks:
      - name: search_input
        type: text_input
        label:
          title: ""
        box:
          width: { md: 24, lg: 16 }
        properties:
          size: large
          placeholder: Did you come here looking for ðŸ¤©?
      - name: search_button
        type: button
        box:
          width: { xs: 12, sm: 14, md: 16, lg: 5 }
        label:
          title: Search
        properties:
          keyCode: 13
          icon: search
          size: large
        actions:
          onClick:
            - set():
                loading: true
                search:
                  _state: search_input
                page.page: 1
                page.skip: 0
            - refresh(): true
            - set():
                loading: false
                results:
                  _request: req_search
      - name: reset_button
        type: button
        box:
          width: { xs: 12, sm: 10, md: 8, lg: 3 }
        label:
          title: Reset
        properties:
          type: default
          icon: reload
          size: large
        actions:
          onClick:
            - reset(): true
      - _ref: search/search_list.yaml
      - name: page
        type: pagination_input
        properties:
          showSizeChanger: true
          showTotal: true
          total:
            _get:
              on:
                _request: req_total
              key: 0.total
        actions:
          onShowSizeChange:
            - set():
                loading: true
            - refresh(): true
            - set():
                loading: false
                results:
                  _request: req_search
          onChange:
            - set():
                loading: true
            - refresh(): req_search
            - set():
                loading: false
                results:
                  _request: req_search
